package main;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

import util.Feature;
import util.WeatherData;

public class GainRaio 
{
  private Feature feature2consider;
  private double partitionPoint;
  private double gainRatio = roundoff(Double.MIN_VALUE);
  private HashMap<Integer,WeatherData> XDataInTrain = new HashMap<Integer,WeatherData>();
  private HashMap<Integer,WeatherData> YDataInTrain = new HashMap<Integer,WeatherData>();
  
  public  double calcInformationRatio(HashMap<Integer,WeatherData> trainDataX,HashMap<Integer,WeatherData> trainDataY,
		                              Feature attribute,String target_val) throws IOException
  {
	  this.feature2consider = attribute;
	  this.XDataInTrain = trainDataX;
	  this.YDataInTrain = trainDataY;
	  HashMap<Integer,Double> XDataTrainAttrbMap = new HashMap<Integer,Double>();
	  XDataTrainAttrbMap = getHashByAttrib(XDataInTrain,attribute);
	  XDataTrainAttrbMap = sortByValue(XDataTrainAttrbMap);
	  trainDataX = getSortedTrain(XDataTrainAttrbMap,trainDataX);
	  trainDataY = getSortedTrain(XDataTrainAttrbMap,trainDataY);
  }
  private HashMap<Integer,WeatherData> getSortedTrain(HashMap<Integer,Double>XDataTrainAttrbMap,HashMap<Integer,WeatherData> dataInTrain)
  {
	  HashMap<Integer,WeatherData> trainData = new HashMap<Integer,WeatherData>(); 
	  for(Map.Entry<Integer, Double> key_FeatureVal : XDataTrainAttrbMap.entrySet())
	  {
		  WeatherData wd = dataInTrain.get(key_FeatureVal.getKey());
		  trainData.put(key_FeatureVal.getKey(), wd);
		  
	  }
	  return trainData;
  }
  private HashMap<Integer,Double> getHashByAttrib(HashMap<Integer,WeatherData> XDataInTrain,Feature attrb)
  {
	  HashMap<Integer,Double> XDataTrainAttrbMap = new HashMap<Integer,Double>();
	  for(Map.Entry<Integer, WeatherData> key_weatherData : XDataInTrain.entrySet())
	  {		  
		 WeatherData wd =  key_weatherData.getValue();
		 ArrayList<Feature> features = wd.getFeatures();
		 for(Feature f : features)
		 {
			 if(f.getName().equals(attrb.getName()))
			 {
				 Double feature_val = Double.parseDouble((String)f.getValues().get(0));
				 XDataTrainAttrbMap.put(key_weatherData.getKey(),feature_val);
			 }
		 }
	  }
	  return XDataTrainAttrbMap;
	  
  }
  public static <K, V extends Comparable<? super V>> HashMap<K, V> sortByValue( HashMap<K, V> map )
  {
      List<Map.Entry<K, V>> list =
          new LinkedList<Map.Entry<K, V>>( map.entrySet() );
      Collections.sort( list, new Comparator<Map.Entry<K, V>>()
      {
          public int compare( Map.Entry<K, V> o1, Map.Entry<K, V> o2 )
          {
              return (o1.getValue()).compareTo( o2.getValue() );
          }
      } );

      HashMap<K, V> result = new LinkedHashMap<K, V>();
      for (HashMap.Entry<K, V> entry : list)
      {
          result.put( entry.getKey(), entry.getValue() );
      }
      return result;
  }
  private double roundoff(double num_2_round)
  {
		return (double)Math.round(num_2_round * 100000d) / 100000d;
   }
}
